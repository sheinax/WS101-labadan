# readdirp [![Weekly downloads](https://img.shields.io/npm/dw/readdirp.svg)](https://github.com/paulmillr/readdirp)

Recursive version of [fs.readdir](https://nodejs.org/api/fs.html#fs_fs_readdir_path_options_callback). Exposes a **stream API** and a **promise API**.


```sh
npm install readdirp
```

```javascript
const readdirp = require('readdirp');

// Use streams to achieve small RAM & CPU footprint.
// 1) Streams example with for-await.
for await (const entry of readdirp('.')) {
  const {path} = entry;
  console.log(`${JSON.stringify({path})}`);
}

// 2) Streams example, non for-await.
// Print out all JS files along with their size within the current folder & subfolders.
readdirp('.', {fileFilter: '*.js', alwaysStat: true})
  .on('data', (entry) => {
    const {path, stats: {size}} = entry;
    console.log(`${JSON.stringify({path, size})}`);
  })
  // Optionally call stream.destroy() in `warn()` in order to abort and cause 'close' to be emitted
  .on('warn', error => console.error('non-fatal error', error))
  .on('error', error => console.error('fatal error', error))
  .on('end', () => console.log('done'));

// 3) Promise example. More RAM and CPU than streams / for-await.
const files = await readdirp.promise('.');
console.log(files.map(file => file.path));

// Other options.
readdirp('test', {
  fileFilter: '*.js',
  directoryFilter: ['!.git', '!*modules']
  // directoryFilter: (di) => di.basename.length === 9
  type: 'files_directories',
  depth: 1
});
```

For more examples, check out `examples` directory.

## API

`const stream = readdirp(root[, options])` — **Stream API**

- Reads given root recursively and returns a `stream` of [entry infos](#entryinfo)
- Optionally can be used like `for await (const entry of stream)` with node.js 10+ (`asyncIterator`).
- `on('data', (entry) => {})` [entry info](#entryinfo) for every file / dir.
- `on('warn', (error) => {})` non-fatal `Error` that prevents a file / dir from being processed. Example: inaccessible to the user.
- `on('error', (error) => {})` fatal `Error` which also ends the stream. Example: illegal options where passed.
- `on('end')` — we are done. Called when all entries were found and no more will be emitted.
- `on('close')` — stream is destroyed via `stream.destroy()`.
  Could be useful if you want to manually abort even on a non fatal error.
  At that point the stream is no longer `readable` and no more entries, warning or errors are emitted
- To learn more about streams, consult the very detailed [nodejs streams documentation](https://nodejs.org/api/stream.html)
  or the [stream-handbook](https://github.com/substack/stream-handbook)

`const entries = await readdirp.promise(root[, options])` — **Promise API**. Returns a list of [entry infos](#entryinfo).

First argument is awalys `root`, path in which to start reading and recursing into subdirectories.

### options

- `fileFilter: ["*.js"]`: filter to include or exclude files. A `Function`, Glob string or Array of glob strings.
    - **Function**: a function that takes an entry info as a parameter and returns true to include or false to exclude the entry
    - **Glob string**: a string (e.g., `*.js`) which is matched using [picomatch](https://github.com/micromatch/picomatch), so go there for more
        information. Globstars (`**`) are not supported since specifying a recursive pattern for an already recursive function doesn't make sense. Negated globs (as explained in the minimatch documentation) are allowed, e.g., `!*.txt` matches everything but text files.
    - **Array of glob strings**: either need to be all inclusive or all exclusive (negated) patterns otherwise an error is thrown.
        `['*.json', '*.js']` includes all JavaScript and Json files.
        `['!.git', '!node_modules']` includes all directories except the '.git' and 'node_modules'.
    - Directories that do not pass a filter will not be recursed into.
- `directoryFilter: ['!.git']`: filter to include/exclude directories found and to recurse into. Directories that do not pass a filter will not be recursed into.
- `depth: 5`: dsp;more</a> <br><br>
    Aquests atacs solen utilitzar correu brossa, anuncis, o redireccions d'uns altres llocs per enganyar-vos i fer-vos revelar informació confidencial. En cas de dubte, <a href="#" class="whiteFont" id="gobackLink">go&nbsp;back</a>.Els llocs maliciosos, que contenen enllaços a programari maliciós, poden malmetre el dispositiu i afectar la vostra capacitat d'utilitzar-lo. Si visiteu un lloc maliciós, el programari maliciós podria infectar automàticament el dispositiu. També és possible que poseu en perill la vostra informació confidencial, com ara contrasenyes, números de targetes de crèdit, informació de contacte o claus d'activació del programari. <a href="#" class="whiteFont" id="learnMoreLink">Learn&nbsp;more</a> <br><br>
    Els llocs maliciosos solen utilitzar correu brossa, anuncis, o redireccions d'uns altres llocs per enganyar-vos i fer-vos descarregar programari maliciós. De vegades, un lloc de confiança pot ser piratejat i utilitzat per enllaçar amb contingut maliciós. En cas de dubte, <a href="#" class="whiteFont" id="gobackLink">go&nbsp;back</a>.Els llocs d'estafes que inclouen contingut enganyós sovint intenten enganyar les persones perquè hi confiïn. Per fer-ho, simulen que són llocs d'empreses conegudes. Si visiteu un lloc d'estafes i feu el que us suggereix, és possible que poseu en perill la informació confidencial, com ara contrasenyes, números de targetes de crèdit, informació de contacte o altres dades financeres. <a href="#" class="whiteFont" id="learnMoreLink"> Més&nbsp;informació</a> <br><br>
    Els llocs d'estafes solen executar finestres emergents en bucle i reproduir àudio en veu alta per tal de convèncer-vos que és bona idea que us hi poseu en contacte. Si interactueu amb un estafador, ja sigui en línia o per telèfon, correu el risc de revelar-li dades financeres i informació personal confidencial, i podríeu acabar perdent diners. La millor opció és tancar la pàgina web o penjar el telèfon. En cas de dubte, <a href="#" class="whiteFont" id="gobackLink">go&nbsp;back</a>.Si decidiu permetre aquest contingut, se us notificarà l'administrador i el contingut estarà disponible durant un període de temps limitat.L'SmartScreen del Microsoft Defender ha marcat aquest contingut com a pesca de credencials. Si decidiu visualitzar aquest contingut, pot ser que se us intenti enganyar perquè reveleu informació personal o financera. És possible que poseu en perill la vostra informació confidencial, com ara contrasenyes, números de targetes de crèdit, informació de contacte o claus d'activació del programari.L'SmartScreen del Microsoft Defender ha marcat aquest contingut com a maliciós. Si decidiu visualitzar aquest contingut, el programari maliciós podria infectar el dispositiu automàticament i danyar-lo. Tamb